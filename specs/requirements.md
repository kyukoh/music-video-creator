# 要件書

## 概要

この機能は、ミュージックビデオ（MV）の作成をサポートするツールです。1曲分のミュージックビデオをシーンごとに分割し、各シーンの歌詞、シーン説明、画像生成プロンプト、シーン画像ファイル、動画生成プロンプト、動画ファイルを統合的に管理できるシステムを提供します。

## 要件

### 要件1

**ユーザーストーリー:** クリエイターとして、ミュージックビデオのシーンを手動で分割・管理したい。自分の創作意図に基づいて各シーンを個別に作業しながら全体の構成を把握できるようにするため。

#### 受け入れ基準

1. 新規シーンが追加された時、ユーザーが手動でシーン情報を入力できる必要がある
2. シーンが作成された時、システム内部でシーン識別子が管理されるが、ユーザー画面にシーン番号は表示されない必要がある
3. シーン一覧が表示された時、全体の構成が視覚的に確認できる必要がある
4. シーンの順序が変更された時、ドラッグ&ドロップで並び替えができ、システムが内部的に順序を管理する必要がある
5. シーンファイルがアップロードされた時、以下の2つの形式で複数のシーンを一括登録できる必要がある
   - 簡易版：歌詞を改行で区切ったテキストファイル
   - 詳細版：シーンリスト構造に合わせたExcel形式ファイル

### 要件2

**ユーザーストーリー:** クリエイターとして、各シーンに対応する歌詞とシーン説明を管理したい。映像と音楽の同期を正確に行うため。

#### 受け入れ基準

1. シーンが選択された時、対応する歌詞部分を入力・編集できる必要がある
2. シーン説明が入力された時、映像の内容やコンセプトを詳細に記録できる必要がある
3. 歌詞とシーン説明が保存された時、他のシーン要素と関連付けられる必要がある
4. 歌詞の時間軸が調整された時、シーンの境界も自動的に更新される必要がある

### 要件3

**ユーザーストーリー:** クリエイターとして、各シーンの画像生成用プロンプトを作成・管理したい。AI画像生成ツールで一貫性のある映像素材を作成するため。

#### 受け入れ基準

1. シーンが選択された時、画像生成プロンプトを入力・編集できる必要がある
2. プロンプトが作成された時、シーン説明や歌詞の内容を参考にした提案機能が利用できる必要がある
3. プロンプトテンプレートが提供された時、一貫したスタイルや品質を維持できる必要がある
4. プロンプト履歴が保存された時、過去のバージョンと比較・復元できる必要がある

### 要件4

**ユーザーストーリー:** クリエイターとして、プロジェクトごとのメディアライブラリで画像ファイルを管理したい。素材を一元管理し、各シーンで効率的に利用するため。

#### 受け入れ基準

1. プロジェクトが作成された時、そのプロジェクト専用のメディアライブラリが作成される必要がある
2. 画像ファイルがアップロードされた時、プロジェクトのメディアライブラリに保存され、一意のIDまたはファイル名が割り当てられる必要がある
3. シーンに画像が関連付けられる時、メディアライブラリのファイルIDまたはファイル名で参照される必要がある
4. 複数の画像候補が存在する時、メディアライブラリから選択できる必要がある
5. 画像ファイルが削除された時、関連するシーンデータの整合性が保たれる必要がある

### 要件5

**ユーザーストーリー:** クリエイターとして、各シーンの動画生成用プロンプトを作成・管理したい。AI動画生成ツールで高品質な映像を作成するため。

#### 受け入れ基準

1. シーンが選択された時、動画生成プロンプトを入力・編集できる必要がある
2. 動画プロンプトが作成された時、対応する画像や歌詞の内容を考慮した提案が提供される必要がある
3. カメラワークや動きの指定が入力された時、技術的なパラメータとして保存される必要がある
4. 動画の長さや品質設定が指定された時、シーンの時間軸と整合性が保たれる必要がある

### 要件6

**ユーザーストーリー:** クリエイターとして、プロジェクトごとのメディアライブラリで動画ファイルを管理したい。動画素材を一元管理し、各シーンで効率的に利用するため。

#### 受け入れ基準

1. 動画ファイルがアップロードされた時、プロジェクトのメディアライブラリに保存され、一意のIDまたはファイル名が割り当てられる必要がある
2. シーンに動画が関連付けられる時、メディアライブラリのファイルIDまたはファイル名で参照される必要がある
3. 動画プレビューが表示された時、シーンの歌詞や説明と同時に確認できる必要がある
4. 複数の動画バージョンが存在する時、メディアライブラリから選択できる必要がある
5. 動画ファイルがエクスポートされた時、編集ソフトウェアで使用可能な形式で出力される必要がある

### 要件7

**ユーザーストーリー:** クリエイターとして、サイドメニューでプロジェクト一覧を管理したい。複数の楽曲プロジェクトを効率的に切り替えて作業するため。

#### 受け入れ基準

1. アプリケーションが起動された時、サイドメニューにプロジェクト一覧が表示される必要がある
2. プロジェクト一覧が表示された時、各プロジェクトの曲名と備考が確認できる必要がある
3. 既存プロジェクトが選択された時、そのプロジェクトのシーン一覧画面に遷移する必要がある
4. 新規プロジェクト追加ボタンがクリックされた時、新しいプロジェクト作成フォームが表示される必要がある
5. プロジェクト削除機能が実行された時、確認ダイアログが表示され、関連ファイルも含めて削除される必要がある

### 要件8

**ユーザーストーリー:** クリエイターとして、プロジェクトに曲名と備考を登録したい。シンプルな情報でプロジェクトを識別・管理するため。

#### 受け入れ基準

1. 新規プロジェクトが作成された時、曲名と備考を入力できる必要がある
2. プロジェクト情報が編集された時、曲名と備考を後から変更できる必要がある
3. プロジェクトが保存された時、曲名と備考が永続化される必要がある
4. プロジェクト一覧が表示された時、曲名と備考が識別情報として表示される必要がある

### 要件9

**ユーザーストーリー:** クリエイターとして、プロジェクトを選択してシーン一覧画面で作業したい。各シーンの詳細情報を一覧形式で効率的に管理するため。

#### 受け入れ基準

1. プロジェクトが選択された時、シーン一覧画面に遷移する必要がある
2. シーン一覧画面が表示された時、シーンリストが表形式で表示される必要がある
3. 新規プロジェクトが選択された時、シーンリストは空の状態で表示される必要がある
4. 各シーン行が表示された時、サムネイル画像、開始時間（分:秒）、歌詞、シーン説明、英語プロンプトが1行に表示される必要がある
5. シーンリストの最下行に表示された時、新しいシーンを追加するための入力欄が提供される必要がある

### 要件11

**ユーザーストーリー:** クリエイターとして、シーン一覧画面で直接編集したい。詳細画面に遷移することなく、効率的にシーン情報を更新するため。

#### 受け入れ基準

1. シーン行の開始時間がクリックされた時、その場で編集可能状態になる必要がある
2. シーン行の歌詞がクリックされた時、その場で編集可能状態になる必要がある
3. シーン行のシーン説明がクリックされた時、その場で編集可能状態になる必要がある
4. シーン行の英語プロンプトがクリックされた時、その場で編集可能状態になる必要がある
5. 編集エリアからフォーカスが外れた時、変更内容が自動的に保存される必要がある
6. サムネイル画像がクリックされた時、シーンの詳細編集画面に遷移する必要がある

### 要件12

**ユーザーストーリー:** クリエイターとして、シーンの詳細編集画面で画像や動画ファイルを管理したい。サムネイル以外の詳細な設定や複雑な編集作業を行うため。

#### 受け入れ基準

1. サムネイル画像がクリックされた時、シーンの詳細編集画面に遷移する必要がある
2. 詳細編集画面が表示された時、画像生成プロンプト、メディアライブラリからの画像選択、動画生成プロンプト、メディアライブラリからの動画選択の管理機能が提供される必要がある
3. メディアファイルが選択された時、ファイルIDまたはファイル名でシーンに関連付けられる必要がある
4. 詳細編集画面で変更が保存された時、シーン一覧画面に戻り、更新内容が反映される必要がある
5. 詳細編集画面からキャンセルされた時、変更内容は破棄され、シーン一覧画面に戻る必要がある

### 要件13

**ユーザーストーリー:** クリエイターとして、プロジェクトごとのメディアライブラリを管理したい。画像・動画ファイルを一元管理し、複数のシーンで再利用するため。

#### 受け入れ基準

1. プロジェクトが作成された時、そのプロジェクト専用のディレクトリが作成され、メディアファイルが格納される必要がある
2. メディアライブラリが表示された時、ファイルエクスプローラーのような画面でアップロード済みファイルのアイコン一覧が表示される必要がある
3. ファイルがアップロードされた時、プロジェクトディレクトリに保存され、メディアライブラリに自動的に反映される必要がある
4. ファイルアイコンがクリックされた時、ファイルの選択状態が切り替わる必要がある
5. 削除機能が実行された時、選択されたファイルがプロジェクトディレクトリから削除され、そのファイルを画像または動画として設定している全てのシーンから自動的に関連付けが解除される必要がある

### 要件14

**ユーザーストーリー:** クリエイターとして、メディアライブラリでファイルタイプ別にフィルタリングしたい。目的のファイルを効率的に見つけて選択するため。

#### 受け入れ基準

1. メディアライブラリが表示された時、「全て表示」「画像のみ」「動画のみ」のフィルタオプションが提供される必要がある
2. 「画像のみ」フィルタが選択された時、画像ファイルのみが一覧表示される必要がある
3. 「動画のみ」フィルタが選択された時、動画ファイルのみが一覧表示される必要がある
4. 「全て表示」フィルタが選択された時、全てのメディアファイルが一覧表示される必要がある
5. フィルタが変更された時、表示内容が即座に更新される必要がある

### 要件15

**ユーザーストーリー:** クリエイターとして、メディアライブラリでドラッグ&ドロップによるファイルアップロードを行いたい。複数のファイルを効率的に一括アップロードするため。

#### 受け入れ基準

1. メディアライブラリ画面が表示された時、ファイルアップロード専用のドロップエリアが提供される必要がある
2. ファイルがドロップエリアにドラッグされた時、ドロップ可能な状態が視覚的に表示される必要がある
3. 単一ファイルがドロップされた時、そのファイルがプロジェクトディレクトリにアップロードされる必要がある
4. 複数ファイルが同時にドロップされた時、全てのファイルが並行してアップロードされる必要がある
5. アップロード中の時、進捗状況が表示され、完了後にメディアライブラリの一覧が自動更新される必要がある

### 要件16

**ユーザーストーリー:** 開発者として、ローカル環境で動作するWebアプリケーションを構築したい。認証機能なしで、シンプルなファイルベースのデータ管理を行うため。

#### 受け入れ基準

1. アプリケーションが起動された時、Webブラウザでアクセス可能なWebアプリケーションとして動作する必要がある
2. ローカル環境で使用される時、認証機能やログイン機能は提供されない必要がある
3. データが保存される時、データベースではなくテキスト形式の設定ファイル（JSON、YAML、INI等）で管理される必要がある
4. バックエンドが実装される時、PHPで開発される必要がある
5. フロントエンドが実装される時、HTML、TailwindCSS CDN、JavaScriptで開発される必要がある
6. プロジェクトデータが管理される時、ファイルシステム上のディレクトリ構造とテキストファイルで永続化される必要がある

### 要件10

**ユーザーストーリー:** クリエイターとして、プロジェクトデータのバックアップと復元機能を使いたい。作業データの安全性を確保し、他の環境でも作業を継続するため。

#### 受け入れ基準

1. プロジェクトファイルがエクスポートされた時、他の環境でも開けるポータブル形式である必要がある
2. バックアップが作成された時、データの損失リスクが最小化される必要がある
3. プロジェクトがインポートされた時、既存のプロジェクト一覧に追加される必要がある
4. 自動保存機能が動作する時、定期的にプロジェクトデータが保存される必要がある